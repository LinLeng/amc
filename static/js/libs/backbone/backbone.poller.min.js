/*!
(c) 2012 Uzi Kilon, Splunk Inc.
Backbone Poller 0.3.0
https://github.com/uzikilon/backbone-poller
Backbone Poller may be freely distributed under the MIT license.
*/
(function(a,b){if(typeof define=="function"&&define.amd){define(["underscore","backbone"],b);
}else{if(typeof require==="function"&&typeof exports==="object"){module.exports=b(require("underscore"),require("backbone"));}else{a.Backbone.Poller=b(a._,a.Backbone);
}}}(this,function(j,i){var e={delay:1000,backoff:false,condition:function(){return true;}};var k=["start","stop","fetch","success","error","complete"];
var f=[];function a(m){return j.find(f,function(n){return n.model===m;});}var d={get:function(n,m){var o=a(n);if(!o){o=new b(n,m);f.push(o);}else{o.set(m);
}if(m&&m.autostart===true){o.start({silent:true});}return o;},size:function(){return f.length;},reset:function(){while(f.length){f.pop().stop();}}};function b(n,m){this.model=n;
this.set(m);}j.extend(b.prototype,i.Events,{set:function(m){this.options=j.extend({},e,m||{});if(this.options.flush){this.off();}j.each(k,function(n){var o=this.options[n];
if(j.isFunction(o)){this.off(n,o,this);this.on(n,o,this);}},this);if(this.model instanceof i.Model){this.model.on("destroy",this.stop,this);}return this.stop({silent:true});
},start:function(m){if(!this.active()){m&&m.silent||this.trigger("start",this.model);this.options.active=true;if(this.options.delayed){g(this);}else{c(this);
}}return this;},stop:function(m){m&&m.silent||this.trigger("stop",this.model);this.options.active=false;this.xhr&&this.xhr.abort&&this.xhr.abort();this.xhr=null;
clearTimeout(this.timeoutId);this.timeoutId=null;return this;},active:function(){return this.options.active===true;}});function c(n){if(h(n)){var m=j.extend({},n.options,{success:function(o,p){n.trigger("success",o,p);
g(n);},error:function(o,p){if(n.options.continueOnError){n.trigger("error",o,p);g(n);}else{n.stop({silent:true});n.trigger("error",o,p);}}});n.trigger("fetch",n.model);
n.xhr=n.model.fetch(m);}}function l(m){if(!m.options.backoff){return m.options.delay;}m._backoff=m._backoff?Math.min(m._backoff*1.1,30):1;return Math.round(m.options.delay*m._backoff);
}function g(m){if(h(m)){
/*!Workaround statement for AMC, this enforces only one timer per poller*/
!!m.timeoutId&&clearTimeout(m.timeoutId);m.timeoutId=j.delay(c,l(m),m);
}}function h(m){if(!m.options.active){return false;}if(m.options.condition(m.model)!==true){m.stop({silent:true});m.trigger("complete",m.model);return false;
}return true;}d.getDelay=l;d.prototype=b.prototype;
/*! AMC specific hook, UNRELEASED*/
d.pollerList=f;return d;}));